# 【VUE】多分支配置优化

之前项目中遇到一个比较有意思的问题：产品详情页底部有两个按钮“加入购物车”和“立即购买”，点击的时候进行不同的操作。这个操作很简单啊，写两个点击方法就行了。

```html
<template>
    <div class="flex course-btn-list">
        <div class="flex-1 course-btn" :class="leftBtnClass" @click="onPutIntoCart">加入购物车</div>
        <div class="flex-1 course-btn on" @click="onBuyItNow">立即购买</div>
    </div>
</template>

<script>
export default {
    methods: {
        onAddIntoCart() {
            // 加入购物车代码
        },
        onBuyItNow() {
            // 立即购买代码
        }
    }
}
</script>
```

easy！太轻松了！

## 多状态

不久，产品过来了：“这个底部按钮还会有其他状态，有些状态只有一个按钮，并且文案也不一样！”好吧貌似这个需要改后台接口，不过后台同学也给力，很快就加了一个status字段。

他跟我说：“我给你加了一个status字段，你根据这个判断按钮状态和文案就行了！”好像听起来很简单，但是仔细一想，发现事情并不简单。

更换文案倒是小事，但点击事件会有更多，不过我们可以使用更多的dom结构来实现，然后根据不同的status来控制不同的dom隐藏显示就行了。第二版方案很快就改好了。

```html
<template>
    <div v-if="status===0" class="flex course-btn-list">
        <div class="flex-1 course-btn" :class="leftBtnClass" @click="onPutIntoCart">加入购物车</div>
        <div class="flex-1 course-btn on" @click="onBuyItNow">立即购买</div>
    </div>
    <div v-if="status===1" class="flex course-btn-list">
        <div class="flex-1 course-btn" :class="leftBtnClass">已加入购物车</div>
    </div>
    <div v-if="status===2" class="flex course-btn-list">
        <div class="flex-1 course-btn" :class="leftBtnClass">产品已失效</div>
    </div>
    <!-- more tag here -->
</template>

<script>
// 请求代码就省略了

export default {
    data() {
        return {
            status: 0
        }
    },
    mounted() {
        this.initPage()
    },
    methods: {
        initPage() {
            if (this.status === 0) {
                this.leftBtnText = '加入购物车'
            } else if (this.status === 1) {
                this.leftBtnText = '已加入购物车'
            } else if (this.status === 2) {
                this.leftBtnText = '产品已失效'
            }
            // more code here
        },
        onAddIntoCart() {
            // 加入购物车代码
        },
        onBuyItNow() {
            // 立即购买代码
        }
    }
}
</script>
```

不过之后再看这段代码，怎么看都不顺眼！

首先，dom结构会随着状态的增多而增多，现在只有三个，保不齐有十个八个呢！其次，这么多if...else真的出自一个写了三年代码的人之手么？（汗流浃背）

不行，不行，得想办法掩盖自己的罪恶，先从js代码开始。

可以替代if...else的都有什么呢？switch...case？这两个代码量没啥太大区别，只是查找方式不一样而已。

这个状态很有规律，0，1，2...这似乎让我们本能地想起了数组的索引值，并且要改的文案属性也一致。

如果我们设定一个数组的，每一项都是一个对象，那我们岂不是只用读取对象属性值就可以了么？这个想法貌似可行...

```html
<template>
    <div v-if="status===0" class="flex course-btn-list">
        <div class="flex-1 course-btn" :class="leftBtnClass" @click="onPutIntoCart">加入购物车</div>
        <div class="flex-1 course-btn on" @click="onBuyItNow">立即购买</div>
    </div>
    <div v-if="status===1" class="flex course-btn-list">
        <div class="flex-1 course-btn" :class="leftBtnClass">已加入购物车</div>
    </div>
    <div v-if="status===2" class="flex course-btn-list">
        <div class="flex-1 course-btn" :class="leftBtnClass">产品已失效</div>
    </div>
    <!-- more tag here -->
</template>

<script>
// 按钮文案的配置文件
const CONFIG = [{
    leftBtnText: '加入购物车'
}, {
    leftBtnText: '已加入购物车'
}, {
    leftBtnText: '产品已失效'
}]

export default {
    data() {
        return {
            status: 0
        }
    },
    mounted() {
        this.initPage()
    },
    methods: {
        initPage() {
            // 拿到了配置
            let btnConfig = CONFIG[this.status]
            // 更新文案
            this.leftBtnText = btnConfig.leftBtnText
        },
        onAddIntoCart() {
            // 加入购物车代码
        },
        onBuyItNow() {
            // 立即购买代码
        }
    }
}
</script>
```

哇！讨厌的一大坨代码立马就不见了，取而代之的是两行清爽的代码，并且逻辑结构依旧分明。

因为是静态的配置文件，我们把CONFIG单独提出来，放在page.js里

```javascript
// 按钮文案的配置文件
const CONFIG = [{
    leftBtnText: '加入购物车'
}, {
    leftBtnText: '已加入购物车'
}, {
    leftBtnText: '产品已失效'
}]
```

嗯，应该很完美了！

但是上面的dom结构还是存在冗余代码。这么多状态，对应的dom结构都是一样的，那我们可不可以共用一个？
