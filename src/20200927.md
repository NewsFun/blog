# 闲侃跨域

前端在处理请求的时候，有时候会遇到这样的问题：

![error](./img/20200927/2020-09-27_104754.jpg)

翻译过来就是：当前请求违反了同源策略，导致了跨域。这就是我们常说的跨域请求。

## 跨域请求是什么

说到跨域请求，就得先说[CORS](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS).

> 跨源资源共享 (CORS) （或通俗地译为跨域资源共享）是一种机制，该机制使用附加的 HTTP 头来告诉浏览器，准许运行在一个源上的Web应用访问位于另一不同源选定的资源。 当一个Web应用发起一个与自身所在源（域，协议和端口）不同的HTTP请求时，它发起的即跨源HTTP请求。

看了定义没看懂，没关系。说白了，只有请求的资源与发请求的页面处于同一个源下，这个请求才不跨域。

怎么定义同一个源呢？域名，协议，端口全部相同，才是同一个源。

## 现实中的跨域

其实所有请求都是电脑之间的通信。我们把服务器类比成一个国家。那么浏览器其实只是国家里面的一个公司或者个人。

假如我们是H公司，是做全球生意的。现在呢，公司要做手机。但是要做手机不得需要各种零部件么？大部分零部件国内有，唯独缺少一个好的芯片。想要芯片得去A公司进口。

于是H公司跟A公司说：我们想要你们的芯片。

A公司收到了通知，一看有人要买自己的芯片，心中大喜，回复：好的。

但是有个问题，H公司在C国，A公司在A国。这可是一桩跨国生意。跨国生意不好做，万一路上有流氓、海盗逼着你开一千万的发票，这里面的风险很高的。所以一般都是国内公司相互做生意。

但是现在可是特殊时期，大洋彼岸的A国人民需要我们的支援。这桩生意，势在必行。这个时候我们知道了拿到芯片的三个重要信息：

时间、地点、人物！！！

错了！这桩生意三大要素：A国(域)、A公司(端口)，还有……他们说川普(协议)！

不去A国找不到A公司，不到A公司买不到芯片，不说川普无法交流。

万事俱备只欠东风！！！东风来了，吹着我们的小帆船出发了。顺利的话，一年半载，我们就带着芯片从西方取经归来了。

但是现在是特殊时期，我们开着友谊的小船，到了A国海关。海关人员一看：H公司啊！对不起，建国同志已经将你们拉入黑名单了。你们无法进入A国。

这时，我们就遇到了跨域请求。

## 如何入境

来都来了，不能这么着回去啊。我们就想想怎么进入A国吧。

这时候，我们看到A国港口船来船往不仅陷入了沉思……

我们发现有一种船只，只要打着src的旗号，就可以堂而皇之地入境。

于是机灵一动，跟A公司说：我们的船换了，现在我们坐着src旗号的船进来了，你们到时候接应一下。

A公司：好的！

这就是jsonp请求！

jsonp请求的原理就是利用资源文件可以跨域传输的原理，把请求参数带入。服务器响应后，将数据包装在回调函数中。本地浏览器执行回调函数后，就可以拿到服务器数据。

那么资源文件都有哪些呢？简单来讲，带有src属性的html标签，都是资源文件。聪明的小伙伴可以去数一数有多少个这样的标签吧。

情形二：

H公司感觉以公司身份跟一个国家对话，力不从心。就向本国政府求助，请政府出面申购。于是我们的交易从H公司到A公司，变成了C国与A国的贸易。这就是代理。

互联网通信中，主机之间的地位是平等的。说白了，就是电脑和电脑通信没有跨域这一说。既然如此，那如果浏览器遇到安全策略问题时，我们可以向服务器C发请求，由服务器C向服务器A转达自己的请求。

从上面的两种情形，我们似乎看到了实现跨域的主流方式。

然而这背后依然隐藏着一个巨大的问题：贸易可以正常进行的基础时A国仍在正常的贸易状态。假如A国坚持闭关锁国，拒绝H公司的一切贸易请求。那不管是打着src旗号还是C国政府出面，H公司也拿不到他们想要的芯片的。

因此对于前端小伙伴来讲，如果遇到跨域问题。最好还是去抱后端小哥哥的大腿吧，好吃好喝好招待，让他们开放白名单。